- route:
    id: sms-svc
    from:
      id: from3ccf
      uri: platform-http
      parameters:
        path: /SmsService.svc?httpMethodRestrict=POST
      steps:
        - convertBodyTo:
            id: convertBodyTo6585
            type: java.lang.String
        - setHeader:
            id: setHeadera745
            description: SH-Content-Type
            name: Content-Type
            expression:
              constant:
                id: constant8bed
                expression: text/xml; charset=UTF-8
        - setProperty:
            id: setProperty97de
            description: SP-rawXml
            name: rawXml
            expression:
              simple:
                id: simpled4f4
                expression: ${body}
                resultType: java.lang.String
        - log:
            id: log9feb
            description: xmlInboundBodyLog
            message: body
            loggingLevel: INFO
            logName: xmlBody
        - setProperty:
            id: setPropertyd067
            description: SP-SmsTo
            name: smsTo
            expression:
              xpath:
                id: xpath7386
                expression: //SmsRequest/To/text()
                resultType: java.lang.String
                trim: false
        - log:
            id: log65df
            message: "{exchangeProperty.smsTo}"
            loggingLevel: INFO
            logName: xxxxx
        - setProperty:
            id: setPropertya304
            name: smsText
            expression:
              xpath:
                id: xpath8111
                expression: /SmsRequest/Text/text()
        - removeHeaders:
            id: removeHeaders1653
            pattern: "*"
        - setBody:
            id: setBodyb486
            description: smsRequestBody
            expression:
              simple:
                id: simpleca89
                expression: |-
                  {
                    "phoneNumber": "${exchangeProperty.smsTo}",
                    "message": "${exchangeProperty.smsText}",
                    "messageType": "N",
                    "recipientType": "B"
                  }
        - log:
            id: logd47a
            message: body
            loggingLevel: INFO
            logName: RequestBody
        - setHeader:
            id: setHeader1565
            description: SH-Content-Type
            name: Content-Type
            expression:
              constant:
                id: constantcf15
                expression: application/json
        - to:
            id: to4e64
            uri: http
            parameters:
              httpUri: http://{{infobip.baseUrl}}/api/sms/send
              httpMethod: POST
        - setHeader:
            id: setHeader8715
            description: SH-Content-Type
            name: Content-Type
            expression:
              constant:
                id: constantba0c
                expression: application/json
        - setBody:
            id: setBody4005
            expression:
              simple:
                id: simple3830
                expression: |-
                  <SmsResponse>
                                <Status>OK</Status>
                                <To>${header.smsTo}</To>
                              </SmsResponse>
